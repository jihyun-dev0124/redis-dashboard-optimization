<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>dashboard</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
<div class="flex min-h-screen">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <aside class="w-60 bg-white border-r border-gray-200 flex flex-col">
        <div class="px-4 py-4 border-b">
            <h1 class="text-lg font-bold text-gray-800">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p class="text-xs text-gray-400 mt-1">Admin Panel</p>
        </div>

        <nav class="flex-1 px-2 py-4 space-y-1 text-sm">
            <!-- ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ ë©”ë‰´ (í˜„ì¬ í˜ì´ì§€ë¼ê³  ê°€ì •, ê°•ì¡°) -->
            <a href="/admin/dashboard/sales"
               class="flex items-center px-3 py-2 rounded-lg bg-blue-50 text-blue-600 font-semibold">
                <span class="mr-2">ğŸ’°</span>
                <span>ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</span>
            </a>
            <!-- íšŒì› ëŒ€ì‹œë³´ë“œ ë©”ë‰´ -->
            <a href="/admin/dashboard/members"
               class="flex items-center px-3 py-2 rounded-lg text-gray-600 hover:bg-gray-100">
                <span class="mr-2">ğŸ‘¤</span>
                <span>íšŒì› ëŒ€ì‹œë³´ë“œ</span>
            </a>
        </nav>

        <div class="px-4 py-3 border-t text-xs text-gray-400">
            &copy; 2025 My Admin
        </div>
    </aside>

    <!-- ì˜¤ë¥¸ìª½ ë©”ì¸ ì˜ì—­ -->
    <main class="flex-1 px-6 py-6">
        <div class="max-w-6xl mx-auto">
            <!-- í—¤ë” -->
            <header class="mb-8 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</h2>
                    <p class="text-sm text-gray-500 mt-1">ì˜¤ëŠ˜ ê¸°ì¤€ ì§‘ê³„ëœ ë§¤ì¶œ í†µê³„ì…ë‹ˆë‹¤.</p>
                </div>
                <!-- í•„í„° ì˜ì—­ (ì˜ˆ: ê¸°ì¤€ì¼ ì„ íƒ ë“± í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— ì¶”ê°€) -->
                <!--
                <div>
                    <input type="date" class="border rounded px-2 py-1 text-sm">
                </div>
                -->
            </header>

            <!-- ìƒë‹¨ ìš”ì•½ ì¹´ë“œ ì˜ì—­ -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" id="summary-cards">
                <!-- ì¹´ë“œ: ì´ ë§¤ì¶œ -->
                <div class="bg-white rounded-2xl shadow p-4">
                    <p class="text-sm text-gray-500">ì´ ë§¤ì¶œì•¡</p>
                    <p id="totalSales" class="mt-2 text-xl font-bold text-gray-800">-</p>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <p class="text-sm text-gray-500">ì–´ì œ ë§¤ì¶œì•¡</p>
                    <p id="salesYesterday" class="mt-2 text-xl font-bold text-gray-800">-</p>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <p class="text-sm text-gray-500">ì´ë²ˆì£¼ ë§¤ì¶œì•¡</p>
                    <p id="salesThisWeek" class="mt-2 text-xl font-bold text-gray-800">-</p>
                </div>
                <!-- í•„ìš”í•˜ë©´ ì¹´ë“œ ë” ì¶”ê°€í•´ì„œ ì´ë²ˆë‹¬, ì§€ë‚œë‹¬, 3ê°œì›”ë„ ìœ„ì— ì˜¬ë¦´ ìˆ˜ ìˆìŒ -->
            </section>

            <!-- ìƒë‹¨ ìš”ì•½ í‘œ -->
            <section class="bg-white rounded-2xl shadow p-4 mb-8">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">ê¸°ê°„ë³„ ë§¤ì¶œ ìš”ì•½</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left">
                        <thead class="border-b text-gray-500">
                        <tr>
                            <th class="py-2 pr-4">ì§€í‘œ</th>
                            <th class="py-2 pr-4 text-right">ê¸ˆì•¡</th>
                        </tr>
                        </thead>
                        <tbody class="divide-y">
                        <tr>
                            <td class="py-2 pr-4">ì´ ë§¤ì¶œì•¡</td>
                            <td id="tbl-totalSales" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">ì–´ì œ ë§¤ì¶œì•¡</td>
                            <td id="tbl-salesYesterday" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">ì´ë²ˆì£¼ ë§¤ì¶œì•¡</td>
                            <td id="tbl-salesThisWeek" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">1ì£¼ì „ ë§¤ì¶œì•¡</td>
                            <td id="tbl-sales1WeeksAgo" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">2ì£¼ì „ ë§¤ì¶œì•¡</td>
                            <td id="tbl-sales2WeeksAgo" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">3ì£¼ì „ ë§¤ì¶œì•¡</td>
                            <td id="tbl-sales3WeeksAgo" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">ì´ë²ˆë‹¬ ë§¤ì¶œì•¡</td>
                            <td id="tbl-salesThisMonth" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">ì§€ë‚œë‹¬ ë§¤ì¶œì•¡</td>
                            <td id="tbl-salesLastMonth" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        <tr>
                            <td class="py-2 pr-4">ì§€ë‚œ 3ê°œì›”ê°„ ë§¤ì¶œì•¡</td>
                            <td id="tbl-salesLast3Months" class="py-2 pr-4 text-right">-</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- í•˜ë‹¨: ìµœê·¼ 8ì£¼ ë§¤ì¶œ ì°¨íŠ¸ -->
            <section class="bg-white rounded-2xl shadow p-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-800">ìµœê·¼ 8ì£¼ ë§¤ì¶œ ì¶”ì´</h2>
                    <span class="text-xs text-gray-400">1ì£¼ì „ ~ 8ì£¼ì „ ë§¤ì¶œ ê¸°ì¤€</span>
                </div>
                <div class="h-72">
                    <canvas id="weeklySalesChart"></canvas>
                </div>
            </section>
        </div>
    </main>
</div>
<script>
    //ìˆ«ì "1,234,567" í˜•ì‹ìœ¼ë¡œ í¬ë§·
    const formatCurrency = (value) =>
        value == null ? '-' : parseInt(value).toLocaleString('ko-KR') + ' ì›';

    async function loadDashboard(){
        try {
            const res = await fetch("/api/dashboard/sales");
            if (!res.ok) {
                throw new Error("ëŒ€ì‹œë³´ë“œ API í˜¸ì¶œ ì‹¤íŒ¨");
            }
            const data = await res.json();

            //ìƒë‹¨ ì¹´ë“œ ê°’ ë°”ì¸ë”©
            document.getElementById("totalSales").textContent = formatCurrency(data.totalSales);
            document.getElementById("salesYesterday").textContent = formatCurrency(data.salesYesterday);
            document.getElementById("salesThisWeek").textContent = formatCurrency(data.salesThisWeek);

            //í‘œ ê°’ ë°”ì¸ë”©
            document.getElementById("tbl-totalSales").textContent = formatCurrency(data.totalSales);
            document.getElementById("tbl-salesYesterday").textContent = formatCurrency(data.salesYesterday);
            document.getElementById("tbl-salesThisWeek").textContent = formatCurrency(data.salesThisWeek);
            document.getElementById("tbl-sales1WeeksAgo").textContent = formatCurrency(data.sales1WeeksAgo);
            document.getElementById("tbl-sales2WeeksAgo").textContent = formatCurrency(data.sales2WeeksAgo);
            document.getElementById("tbl-sales3WeeksAgo").textContent = formatCurrency(data.sales3WeeksAgo);
            document.getElementById("tbl-salesThisMonth").textContent = formatCurrency(data.salesThisMonth);
            document.getElementById("tbl-salesLastMonth").textContent = formatCurrency(data.salesLastMonth);
            document.getElementById("tbl-salesLast3Months").textContent = formatCurrency(data.salesLast3Months);

            // ì°¨íŠ¸ ë°ì´í„° êµ¬ì„± (1ì£¼ ì „ ~ 8ì£¼ ì „, ì´ë²ˆì£¼)
            const labels = ['8ì£¼ ì „', '7ì£¼ ì „', '6ì£¼ ì „', '5ì£¼ ì „', '4ì£¼ ì „', '3ì£¼ ì „', '2ì£¼ ì „', '1ì£¼ ì „', 'ì´ë²ˆì£¼'];

            const weeklyData = [
                data.sales8WeeksAgo,
                data.sales7WeeksAgo,
                data.sales6WeeksAgo,
                data.sales5WeeksAgo,
                data.sales4WeeksAgo,
                data.sales3WeeksAgo,
                data.sales2WeeksAgo,
                data.sales1WeeksAgo,
                data.salesThisWeek
            ];

            const ctx = document.getElementById("weeklySalesChart").getContext("2d");

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì£¼ê°„ ë§¤ì¶œì•¡',
                        data: weeklyData,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return value.toLocaleString('ko-KR') + ' ì›';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callback: {
                                label: function (context) {
                                    const value = context.parsed.y || 0;
                                    return value.toLocaleString('ko-KR') + ' ì›';
                                }
                            }
                        }
                    }
                }
            });
        } catch (e) {
            console.error(e);
            alert("ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    document.addEventListener('DOMContentLoaded', loadDashboard);
</script>
</body>
</html>